<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Interactiva y Asistente IA de Ecuaciones Diferenciales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- KaTeX for beautiful math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMeaOjwCLHsgoIBiKAwbBIeltQKb7eoFNOlfNLcdJdTEa9geb" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlVwcjNcsNQTeKaix6bYafGITIKlEgaEDRTkg6bA/0BlOdlvdLdQYJeMCYY" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax5AScKprqUXsoH41W5ZBVHutoQN/cxEq2I" crossorigin="anonymous"></script>

    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: Se ha dise√±ado una aplicaci√≥n de una sola p√°gina con una navegaci√≥n superior basada en pesta√±as. Cada pesta√±a corresponde a un m√©todo de resoluci√≥n de EDOs de primer orden. Esta estructura de "dashboard" o "caja de herramientas" es ideal para una gu√≠a de estudio, ya que permite al usuario acceder directamente al tema de inter√©s sin necesidad de desplazarse por contenido irrelevante. El flujo es simple: el usuario selecciona un tipo de ecuaci√≥n y la aplicaci√≥n muestra instant√°neamente la informaci√≥n relevante (identificaci√≥n, m√©todo, f√≥rmulas). Se eligi√≥ este dise√±o por ser altamente funcional y estar orientado a la tarea principal del usuario: identificar y resolver un problema espec√≠fico r√°pidamente. -->
    <!-- Visualization & Content Choices: El contenido de la gu√≠a de estudio es procedimental y basado en f√≥rmulas, por lo que no se requieren gr√°ficos o tablas de datos. La informaci√≥n se presenta utilizando una jerarqu√≠a clara con encabezados, listas ordenadas para los pasos de resoluci√≥n y bloques de c√≥digo estilizados para resaltar las f√≥rmulas matem√°ticas. El objetivo es la claridad y la legibilidad. La interactividad principal es la navegaci√≥n por pesta√±as, que permite al usuario controlar qu√© contenido se muestra. Esta elecci√≥n de presentaci√≥n directa y estructurada con HTML/Tailwind es la m√°s efectiva para comunicar esta informaci√≥n t√©cnica. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .formula-block {
            font-family: 'Roboto Mono', monospace;
            background-color: #f1f5f9; /* slate-100 */
            border-left: 4px solid #14b8a6; /* teal-500 */
            padding: 1rem;
            border-radius: 0.25rem;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .nav-btn {
            transition: all 0.2s ease-in-out;
            border-bottom: 2px solid transparent;
        }
        .nav-btn.active {
            border-bottom-color: #14b8a6; /* teal-500 */
            color: #0f766e; /* teal-700 */
            font-weight: 600;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .gemini-btn {
            background-color: #0d9488; /* teal-600 */
            color: white;
            transition: background-color 0.2s;
            opacity: 1;
        }
        .gemini-btn:hover {
            background-color: #0f766e; /* teal-700 */
        }
        .gemini-btn:disabled {
            background-color: #a1a1aa; /* zinc-400 */
            cursor: not-allowed;
        }
        .loader {
            width: 24px;
            height: 24px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #14b8a6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        .katex-display {
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 0.5rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="min-h-screen container mx-auto px-4 py-8 md:py-12">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900">Gu√≠a Interactiva y Asistente IA de Ecuaciones Diferenciales</h1>
            <p class="mt-2 text-lg text-slate-600">Una gu√≠a para identificar, resolver y aplicar los tipos m√°s comunes, ahora con IA.</p>
        </header>

        <nav class="mb-8 border-b border-slate-200">
            <ul class="flex flex-wrap -mb-px justify-center text-sm font-medium text-center text-slate-500">
                <li class="mr-2">
                    <button class="nav-btn inline-block p-4 rounded-t-lg" data-target="separables">Variables Separables</button>
                </li>
                <li class="mr-2">
                    <button class="nav-btn inline-block p-4 rounded-t-lg" data-target="homogeneas">Homog√©neas</button>
                </li>
                <li class="mr-2">
                    <button class="nav-btn inline-block p-4 rounded-t-lg" data-target="exactas">Exactas</button>
                </li>
                <li class="mr-2">
                    <button class="nav-btn inline-block p-4 rounded-t-lg" data-target="lineales">Lineales</button>
                </li>
                <li class="mr-2">
                    <button class="nav-btn inline-block p-4 rounded-t-lg" data-target="bernoulli">Bernoulli</button>
                </li>
                <li class="mr-2">
                    <button class="nav-btn inline-block p-4 rounded-t-lg" data-target="coeficientes">Coef. Lineales</button>
                </li>
                 <li class="mr-2">
                    <button class="nav-btn inline-block p-4 rounded-t-lg font-bold text-teal-600" data-target="aplicaciones">Aplicaciones</button>
                </li>
            </ul>
        </nav>

        <main>
            <!-- Template for Method Sections -->
            <template id="method-template">
                <div class="border-t-2 border-slate-200 mt-8 pt-6">
                    <h3 class="text-xl font-semibold mb-3 text-slate-800">Asistente IA</h3>
                    <p class="text-slate-600 mb-4">¬øNecesitas m√°s pr√°ctica? Genera un nuevo problema de ejemplo con un solo clic.</p>
                    <button class="gemini-btn gemini-example-btn font-bold py-2 px-4 rounded-lg inline-flex items-center">
                        <span class="mr-2">‚ú®</span> Generar Nuevo Ejemplo
                    </button>
                    <div class="gemini-result-container mt-4 p-4 bg-slate-50 rounded-lg min-h-[80px]">
                        <!-- Gemini result will be injected here -->
                    </div>
                    <div class="solution-block hidden mt-4">
                        <button class="gemini-btn gemini-solve-btn font-bold py-2 px-4 rounded-lg inline-flex items-center">
                           <span class="mr-2">üß†</span> Resolver Paso a Paso
                        </button>
                        <div class="gemini-solve-result-container mt-4 p-4 border border-slate-200 rounded-lg min-h-[100px]">
                           <!-- Step-by-step solution will be injected here -->
                        </div>
                    </div>
                </div>
            </template>

            <!-- Sections -->
            <section id="separables" class="content-section bg-white p-6 md:p-8 rounded-lg shadow-md"></section>
            <section id="homogeneas" class="content-section bg-white p-6 md:p-8 rounded-lg shadow-md"></section>
            <section id="exactas" class="content-section bg-white p-6 md:p-8 rounded-lg shadow-md"></section>
            <section id="lineales" class="content-section bg-white p-6 md:p-8 rounded-lg shadow-md"></section>
            <section id="bernoulli" class="content-section bg-white p-6 md:p-8 rounded-lg shadow-md"></section>
            <section id="coeficientes" class="content-section bg-white p-6 md:p-8 rounded-lg shadow-md"></section>
            
            <!-- Aplicaciones -->
            <section id="aplicaciones" class="content-section bg-white p-6 md:p-8 rounded-lg shadow-md">
                 <h2 class="text-2xl font-bold mb-4 text-teal-700">7. Aplicaciones de Ecuaciones de 1er Orden</h2>
                 <p class="mb-6 text-slate-600">Las ecuaciones diferenciales son la base para modelar c√≥mo cambian los sistemas en el tiempo. Aqu√≠ hay algunos ejemplos cl√°sicos.</p>
                 <div class="space-y-8">
                    <!-- Existing application content here... -->
                 </div>
                 <div class="border-t-2 border-slate-200 mt-8 pt-6">
                    <h3 class="text-xl font-semibold mb-3 text-slate-800">‚ú® Descubre Aplicaciones en tu Campo</h3>
                    <p class="text-slate-600 mb-4">Introduce un √°rea de estudio o industria (ej: "biolog√≠a", "finanzas", "ingenier√≠a aeroespacial") y la IA encontrar√° una aplicaci√≥n relevante.</p>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="app-query-input" placeholder="Ej: qu√≠mica, econom√≠a..." class="flex-grow p-2 border border-slate-300 rounded-lg">
                        <button id="gemini-app-btn" class="gemini-btn font-bold py-2 px-4 rounded-lg">Encontrar Aplicaci√≥n Real</button>
                    </div>
                    <div id="gemini-app-result-container" class="mt-4 p-4 bg-slate-50 rounded-lg min-h-[120px]">
                        <!-- Gemini app result will be injected here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const contentData = {
                separables: {
                    name: "Variables Separables",
                    title: "1. Ecuaciones de Variables Separables",
                    description: "Son el tipo m√°s sencillo. La estrategia es aislar cada variable a un lado de la ecuaci√≥n para poder integrar.",
                    content: `
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="text-xl font-semibold mb-2">Identificaci√≥n</h3>
                                <p class="mb-3">La ecuaci√≥n se puede reescribir algebraicamente en la siguiente forma:</p>
                                <div class="formula-block">g(y) dy = f(x) dx</div>
                            </div>
                            <div>
                                <h3 class="text-xl font-semibold mb-2">M√©todo de Soluci√≥n</h3>
                                <p class="mb-3">Una vez separadas las variables, se integra cada lado de la ecuaci√≥n de forma independiente.</p>
                                <div class="formula-block">‚à´ g(y) dy = ‚à´ f(x) dx + C</div>
                            </div>
                        </div>`,
                    prompt: "Genera un ejemplo de una ecuaci√≥n diferencial de primer orden de variables separables en la forma g(y)dy = f(x)dx. Proporciona solo la ecuaci√≥n. Usa funciones comunes como polinomios, sin, cos o e^x. Usa delimitadores de $$ para la matem√°tica."
                },
                homogeneas: {
                    name: "Homog√©neas",
                    title: "2. Ecuaciones Homog√©neas",
                    description: "Estas ecuaciones se caracterizan porque todos sus t√©rminos tienen el mismo grado. Se resuelven con una sustituci√≥n que las convierte en ecuaciones de variables separables.",
                    content: `
                        <h3 class="text-xl font-semibold mb-2">Identificaci√≥n</h3>
                        <p class="mb-3">La ecuaci√≥n se puede expresar en funci√≥n del cociente y/x:</p>
                        <div class="formula-block mb-6">dy/dx = F(y/x)</div>
                        <h3 class="text-xl font-semibold mb-2">M√©todo de Soluci√≥n</h3>
                        <ol class="list-decimal list-inside space-y-4">
                            <li><span class="font-semibold">Realizar la sustituci√≥n clave:</span> v = y/x ‚Üí y = vx</li>
                            <li><span class="font-semibold">Derivar y reemplazar:</span> dy/dx = v + x (dv/dx)</li>
                            <li><span class="font-semibold">Resolver la nueva ecuaci√≥n</span> de variables separables.</li>
                            <li><span class="font-semibold">Revertir la sustituci√≥n:</span> Se reemplaza v = y/x.</li>
                        </ol>`,
                    prompt: "Genera un ejemplo de una ecuaci√≥n diferencial homog√©nea de primer orden en la forma dy/dx = F(y/x). Proporciona solo la ecuaci√≥n. Aseg√∫rate de que F(y/x) sea una funci√≥n de la relaci√≥n y/x. Usa delimitadores de $$ para la matem√°tica."
                },
                 exactas: {
                    name: "Exactas",
                    title: "3. Ecuaciones Exactas",
                    description: `Provienen de la diferenciaci√≥n total de una funci√≥n F(x, y). La clave es verificar primero la "condici√≥n de exactitud".`,
                    content: `
                        <h3 class="text-xl font-semibold mb-2">Identificaci√≥n</h3>
                        <div class="formula-block mb-6">M(x, y) dx + N(x, y) dy = 0</div>
                        <h3 class="text-xl font-semibold mb-2">Condici√≥n de Exactitud</h3>
                        <div class="formula-block mb-6">‚àÇM/‚àÇy = ‚àÇN/‚àÇx</div>
                        <h3 class="text-xl font-semibold mb-2">M√©todo de Soluci√≥n</h3>
                        <p class="mb-3">La soluci√≥n es F(x, y) = C. Se encuentra integrando M respecto a x, derivando respecto a y, e igualando a N para hallar la funci√≥n constante g(y).</p>`,
                    prompt: "Genera un ejemplo de una ecuaci√≥n diferencial exacta de primer orden en la forma M(x, y)dx + N(x, y)dy = 0. Proporciona solo la ecuaci√≥n. Aseg√∫rate de que cumpla la condici√≥n de exactitud ‚àÇM/‚àÇy = ‚àÇN/‚àÇx. Usa delimitadores de $$ para la matem√°tica."
                },
                lineales: {
                    name: "Lineales",
                    title: "4. Ecuaciones Lineales",
                    description: `Estas ecuaciones tienen una estructura muy definida. Se resuelven con un "factor integrante" que las hace f√°cilmente integrables.`,
                    content: `
                        <h3 class="text-xl font-semibold mb-2">Identificaci√≥n (Forma Est√°ndar)</h3>
                        <div class="formula-block mb-6">dy/dx + P(x)y = Q(x)</div>
                        <h3 class="text-xl font-semibold mb-2">M√©todo de Soluci√≥n</h3>
                        <ol class="list-decimal list-inside space-y-4">
                           <li><span class="font-semibold">Calcular el Factor Integrante (Œº):</span><div class="formula-block mt-2">Œº(x) = e^(‚à´ P(x)dx)</div></li>
                           <li><span class="font-semibold">Aplicar la f√≥rmula de soluci√≥n:</span><div class="formula-block mt-2">y * Œº(x) = ‚à´ Q(x) * Œº(x) dx + C</div></li>
                           <li><span class="font-semibold">Despejar y.</span></li>
                        </ol>`,
                    prompt: "Genera un ejemplo de una ecuaci√≥n diferencial lineal de primer orden en la forma dy/dx + P(x)y = Q(x). Proporciona solo la ecuaci√≥n. Usa funciones P(x) y Q(x) que sean integrables con m√©todos est√°ndar. Usa delimitadores de $$ para la matem√°tica."
                },
                bernoulli: {
                    name: "de Bernoulli",
                    title: "5. Ecuaci√≥n de Bernoulli",
                    description: "Son ecuaciones no lineales que se parecen mucho a las lineales. Una sustituci√≥n inteligente las transforma en una ecuaci√≥n lineal que ya sabemos resolver.",
                    content: `
                        <h3 class="text-xl font-semibold mb-2">Identificaci√≥n</h3>
                        <div class="formula-block mb-6">dy/dx + P(x)y = Q(x)y‚Åø</div>
                        <h3 class="text-xl font-semibold mb-2">M√©todo de Soluci√≥n</h3>
                        <ol class="list-decimal list-inside space-y-4">
                           <li><span class="font-semibold">Realizar la sustituci√≥n clave:</span><div class="formula-block mt-2">v = y¬π‚Åª‚Åø</div></li>
                           <li><span class="font-semibold">Transformar a ecuaci√≥n lineal:</span><div class="formula-block mt-2">dv/dx + (1-n)P(x)v = (1-n)Q(x)</div></li>
                           <li><span class="font-semibold">Resolver la ecuaci√≥n lineal para 'v'.</span></li>
                           <li><span class="font-semibold">Revertir la sustituci√≥n.</span></li>
                        </ol>`,
                    prompt: "Genera un ejemplo de una ecuaci√≥n de Bernoulli de primer orden en la forma dy/dx + P(x)y = Q(x)y^n, donde n no es 0 ni 1. Proporciona solo la ecuaci√≥n. Usa delimitadores de $$ para la matem√°tica."
                },
                coeficientes: {
                    name: "con Coeficientes Lineales",
                    title: "6. Ecuaciones con Coeficientes Lineales",
                    description: "La forma de esta ecuaci√≥n involucra dos l√≠neas rectas. El m√©todo de soluci√≥n depende de si estas l√≠neas se cruzan o son paralelas.",
                    content: `
                        <h3 class="text-xl font-semibold mb-2">Identificaci√≥n</h3>
                        <div class="formula-block mb-6">(a‚ÇÅx + b‚ÇÅy + c‚ÇÅ)dx + (a‚ÇÇx + b‚ÇÇy + c‚ÇÇ)dy = 0</div>
                        <h3 class="text-xl font-semibold mb-2">An√°lisis de Casos</h3>
                        <p class="mb-4">Se debe calcular el determinante \`a‚ÇÅb‚ÇÇ - a‚ÇÇb‚ÇÅ\`.</p>
                        <div class="grid md:grid-cols-2 gap-6">
                           <div class="border border-slate-200 rounded-lg p-4"><h4 class="font-semibold text-lg mb-2">Caso 1: L√≠neas se cruzan (‚â† 0)</h4><p>Se usa la sustituci√≥n x = u + h, y = v + k para convertirla en una homog√©nea.</p></div>
                           <div class="border border-slate-200 rounded-lg p-4"><h4 class="font-semibold text-lg mb-2">Caso 2: L√≠neas paralelas (= 0)</h4><p>Se usa la sustituci√≥n z = a‚ÇÅx + b‚ÇÅy para convertirla en una de variables separables.</p></div>
                        </div>`,
                    prompt: "Genera un ejemplo de una ecuaci√≥n diferencial con coeficientes lineales en la forma (a1x + b1y + c1)dx + (a2x + b2y + c2)dy = 0. Proporciona solo la ecuaci√≥n. Usa delimitadores de $$ para la matem√°tica."
                }
            };

            const mainContainer = document.querySelector('main');
            const template = document.getElementById('method-template');

            Object.keys(contentData).forEach(key => {
                const section = document.getElementById(key);
                if(section){
                    const data = contentData[key];
                    section.dataset.methodName = data.name;
                    let content = `
                        <h2 class="text-2xl font-bold mb-4 text-teal-700">${data.title}</h2>
                        <p class="mb-6 text-slate-600">${data.description}</p>
                        ${data.content}`;
                    
                    const geminiBlock = template.content.cloneNode(true);
                    geminiBlock.querySelector('.gemini-example-btn').dataset.prompt = data.prompt;
                    section.innerHTML = content;
                    section.appendChild(geminiBlock);
                }
            });
            
            // Populate applications tab content
            document.querySelector('#aplicaciones .space-y-8').innerHTML = `
                <div>
                    <h3 class="text-xl font-semibold mb-2">Crecimiento y Decaimiento Exponencial</h3>
                    <p class="mb-3">Describe fen√≥menos donde la tasa de cambio de una cantidad es proporcional a la cantidad misma.</p>
                    <div class="formula-block mb-3">dy/dt = ky</div>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-2">Ley de Enfriamiento de Newton</h3>
                    <p class="mb-3">La tasa a la que un objeto cambia de temperatura es proporcional a la diferencia entre su temperatura y la del ambiente.</p>
                    <div class="formula-block mb-3">dT/dt = k(T - T‚Çê)</div>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-2">Problemas de Mezclas</h3>
                    <p class="mb-3">Modelan la cantidad de una sustancia en un tanque donde un fluido entra y sale.</p>
                    <div class="formula-block mb-3">dA/dt = (tasa entrada) - (tasa salida)</div>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-2">Circuitos El√©ctricos RL en Serie</h3>
                    <p class="mb-3">Describe la corriente en un circuito simple con una resistencia, un inductor y una fuente de voltaje.</p>
                    <div class="formula-block mb-3">L (dI/dt) + RI = V(t)</div>
                </div>
            `;

            // Navigation
            const navButtons = document.querySelectorAll('.nav-btn');
            const contentSections = document.querySelectorAll('.content-section');
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-target');
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    contentSections.forEach(section => section.classList.toggle('active', section.id === targetId));
                });
            });
            document.querySelector('.nav-btn[data-target="separables"]').click();

            // Gemini API Call Logic
            const apiKey = "AIzaSyCl3DHOrqxjQEptoFMttbVsRtiEFAoAlGU"; 
            const model = "gemini-2.5-flash-preview-05-20";

            async function callGemini(prompt, useGrounding = false, retries = 3, delay = 1000) {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                };

                if (useGrounding) {
                    payload.tools = [{ "google_search": {} }];
                }

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && retries > 0) { // Throttling
                            await new Promise(res => setTimeout(res, delay));
                            return callGemini(prompt, useGrounding, retries - 1, delay * 2);
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    return result;

                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                     if (retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return callGemini(prompt, useGrounding, retries - 1, delay * 2);
                    }
                    return null;
                }
            }

            function renderMath(container) {
                 if (window.renderMathInElement) {
                    window.renderMathInElement(container, {
                        delimiters: [
                            {left: "$$", right: "$$", display: true},
                            {left: "$", right: "$", display: false}
                        ]
                    });
                }
            }
            
            // Event Listeners for Gemini Example Buttons
            document.querySelectorAll('.gemini-example-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const btn = event.currentTarget;
                    const prompt = btn.dataset.prompt;
                    const resultContainer = btn.nextElementSibling;
                    const solutionBlock = resultContainer.nextElementSibling;
                    const solveBtn = solutionBlock.querySelector('.gemini-solve-btn');
                    const solveResultContainer = solutionBlock.querySelector('.gemini-solve-result-container');

                    // Reset state
                    solutionBlock.classList.add('hidden');
                    solveResultContainer.innerHTML = '';
                    resultContainer.dataset.problem = '';
                    resultContainer.innerHTML = '<div class="loader"></div>';
                    btn.disabled = true;

                    const result = await callGemini(prompt);
                    
                    if (result && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        const text = result.candidates[0].content.parts[0].text;
                        resultContainer.innerHTML = `<div class="formula-block">${text.trim()}</div>`;
                        resultContainer.dataset.problem = text.trim();
                        renderMath(resultContainer);
                        solutionBlock.classList.remove('hidden');
                    } else {
                        resultContainer.innerHTML = `<p class="text-red-500">No se pudo generar un ejemplo. Int√©ntalo de nuevo.</p>`;
                    }
                    btn.disabled = false;
                });
            });

            // Event Listeners for Gemini Solve Buttons
             document.querySelectorAll('.gemini-solve-btn').forEach(button => {
                button.addEventListener('click', async (event) => {
                    const btn = event.currentTarget;
                    const section = btn.closest('.content-section');
                    const methodName = section.dataset.methodName;
                    const resultContainer = section.querySelector('.gemini-result-container');
                    const problem = resultContainer.dataset.problem;
                    const solveResultContainer = btn.nextElementSibling;

                    if (!problem) {
                        solveResultContainer.innerHTML = `<p class="text-red-500">Primero genera un problema.</p>`;
                        return;
                    }

                    solveResultContainer.innerHTML = '<div class="loader"></div>';
                    btn.disabled = true;

                    const solvePrompt = `Resuelve la siguiente ecuaci√≥n diferencial de primer orden paso a paso, explicando cada parte del proceso. La ecuaci√≥n es: ${problem}. El m√©todo a usar es el de Ecuaciones ${methodName}. Formatea la soluci√≥n con encabezados claros para cada paso (por ejemplo, 'Paso 1: ...') y usa delimitadores de $$ para todas las expresiones matem√°ticas.`;
                    
                    const result = await callGemini(solvePrompt);

                    if (result && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        const text = result.candidates[0].content.parts[0].text;
                        solveResultContainer.innerHTML = text.replace(/\n/g, '<br>');
                        renderMath(solveResultContainer);
                    } else {
                         solveResultContainer.innerHTML = `<p class="text-red-500">No se pudo generar la soluci√≥n. Int√©ntalo de nuevo.</p>`;
                    }
                    btn.disabled = false;
                });
            });
            
            // Event Listener for Gemini Application Button
            document.getElementById('gemini-app-btn').addEventListener('click', async () => {
                const query = document.getElementById('app-query-input').value.trim();
                const btn = document.getElementById('gemini-app-btn');
                if (!query) {
                    alert("Por favor, introduce un campo de estudio.");
                    return;
                }
                
                const resultContainer = document.getElementById('gemini-app-result-container');
                resultContainer.innerHTML = '<div class="loader"></div>';
                btn.disabled = true;
                
                const prompt = `Busca y explica brevemente una aplicaci√≥n del mundo real de las ecuaciones diferenciales de primer orden en el campo de "${query}". Describe el escenario, la ecuaci√≥n que lo modela y qu√© representa.`;
                
                const result = await callGemini(prompt, true);

                if (result && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                    let html = `<p>${result.candidates[0].content.parts[0].text.replace(/\n/g, '<br>')}</p>`;
                    
                    const groundingMetadata = result.candidates[0]?.groundingMetadata;
                    if (groundingMetadata?.groundingAttributions?.length > 0) {
                        html += `<h4 class="font-semibold mt-4 mb-2">Fuentes:</h4><ul class="list-disc list-inside text-sm">`;
                        groundingMetadata.groundingAttributions.forEach(attr => {
                            if (attr.web?.uri) {
                                html += `<li><a href="${attr.web.uri}" target="_blank" class="text-teal-600 hover:underline">${attr.web.title || attr.web.uri}</a></li>`;
                            }
                        });
                        html += `</ul>`;
                    }
                    resultContainer.innerHTML = html;
                } else {
                    resultContainer.innerHTML = `<p class="text-red-500">No se pudo encontrar una aplicaci√≥n. Intenta con otro t√©rmino.</p>`;
                }
                btn.disabled = false;
            });
        });
    </script>
</body>
</html>



